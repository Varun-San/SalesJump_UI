<div *ngIf="isAddCompetitions" class="card shadow p-3" id="Add-Division">
    <mat-stepper linear #stepper>
        <!-- ! DETIALS STEPPER -->
        <mat-step [stepControl]="firstFormGroup" [editable]="isEditable">
            <div class="card-body" [formGroup]="firstFormGroup">
                <ng-template matStepLabel>Details</ng-template>
                <div class="card-body p-0 mt-1">
                    <div class="row col-12">
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">Competition Title <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input type="text" matInput formControlName="competitionTitle">
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">Start Date <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="startDate_details"
                                            formControlName="startDate" />
                                        <img src="Assets/AddCurrency/Calendar.svg" alt="Calendar Icon"
                                            (click)="startDate_details.open()" class="calendar-icon" />
                                        <mat-datepicker #startDate_details></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">End Date <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="endDate_Details" formControlName="endDate" />
                                        <img src="Assets/AddCurrency/Calendar.svg" alt="Calendar Icon"
                                            (click)="endDate_Details.open()" class="calendar-icon" />
                                        <mat-datepicker #endDate_Details></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label">Competition Type <span class="text-danger">*</span></label>
                                <div class="row" [formGroup]="firstFormGroup">

                                    <!-- Player Competition -->
                                    <div class="col-md-4">
                                        <input type="radio" class="btn-check" id="player" value="player"
                                            formControlName="competitionType" name="competitionType"
                                            autocomplete="off" />
                                        <label class="btn btn-outline-primary w-100 text-start p-3" for="player">
                                            <div class="me-3 fs-3">
                                                <img src="Assets/Gamification/Player.svg" alt="Player Icon"
                                                    class="img-fluid"
                                                    style="height: 2.5rem; padding: 3px; margin-bottom: 10px;" />
                                            </div>
                                            <div>
                                                <h5>Player Competition</h5>
                                                <p class="text-muted small mb-0">
                                                    Players compete against each other to see who can reach a specific
                                                    target at a period of time.
                                                </p>
                                            </div>
                                        </label>
                                    </div>

                                    <!-- Team Competition -->
                                    <div class="col-md-4">
                                        <input type="radio" class="btn-check" id="team" value="team"
                                            formControlName="competitionType" name="competitionType"
                                            autocomplete="off" />
                                        <label class="btn btn-outline-primary w-100 text-start p-3" for="team">
                                            <div class="me-3 fs-3">
                                                <img src="Assets/Gamification/Team.svg" alt="Team Icon"
                                                    class="img-fluid"
                                                    style="height: 2.5rem; padding: 3px; margin-bottom: 10px;" />
                                            </div>
                                            <div>
                                                <h5>Team Competition</h5>
                                                <p class="text-muted small mb-0">
                                                    Teams compete against each other to reach a specific target at a
                                                    period of time.
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="flex-grow-1">
                    <hr style="margin-top: 119px;" />
                </div>
                <div class="col-12 d-flex gap-2 justify-content-end align-items-center">
                    <button class="btn btn-outline-secondary" (click)="closeCard()">Cancel</button>
                    <button class="btn btn-primary" matStepperNext (click)="onFirstStepNext()">Next</button>
                </div>
            </div>
        </mat-step>
        <!-- ! TARGET AND PLAYERS -->
        <mat-step [stepControl]="secondFormGroup" [editable]="isEditable">
            <div class="card-body" [formGroup]="secondFormGroup">
                <ng-template matStepLabel>Target & Players</ng-template>
                <div class="card-body p-0 mt-1">
                    <div class="row col-12">
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">Formula <span class="text-danger">*</span><img
                                        src="Assets/Gamification/Info.svg" alt="Add Icon" height="20" width="20"
                                        class="me-2" /></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input type="text" matInput formControlName="formula">
                                    </mat-form-field>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" role="switch"
                                        id="flexSwitchCheckDefault">
                                    <label class="form-check-label" for="flexSwitchCheckDefault">Add Target <span>
                                            <img src="Assets/Gamification/Info_blue.svg" alt="Add Icon" height="20"
                                                width="20" class="me-2" matTooltip="Target indicates order values"
                                                matTooltipPosition="right" />
                                        </span></label>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">Start Date <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="startDate_TandP"
                                            formControlName="startDate_TandP" />
                                        <img src="Assets/AddCurrency/Calendar.svg" alt="Calendar Icon"
                                            (click)="startDate_TandP.open()" class="calendar-icon" />
                                        <mat-datepicker #startDate_TandP></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="mb-3">
                                <label class="form-label">End Date <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput [matDatepicker]="endDate_TandP"
                                            formControlName="endDate_TandP" />
                                        <img src="Assets/AddCurrency/Calendar.svg" alt="Calendar Icon"
                                            (click)="endDate_TandP.open()" class="calendar-icon" />
                                        <mat-datepicker #endDate_TandP></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="description" class="form-label">Target</label>
                                <textarea class="form-control" id="description" rows="3"></textarea>
                            </div>
                        </div>
                        <!-- !Ng Prime -->
                        <!-- <div class="col-12">
                            <p-sidebar [(visible)]="sidebarVisible" position="right">
                                <h3>Sidebar</h3>
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua.
                                    Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                                    aliquip ex ea commodo consequat.
                                </p>
                            </p-sidebar>
                            <p-button (onClick)="sidebarVisible = true" class="p-button-text">
                                <ng-template pTemplate="content">
                                    <img src="Assets/AdminMasters/Add.svg" alt="Add Icon" height="16" width="16"
                                        class="me-2" />
                                    Add Players
                                </ng-template>
                            </p-button>
                        </div> -->

                        <div class="col-1" style="display: block;" *ngIf="competitionType === 'player'">
                            <button class="btn filter-btn d-flex align-items-center justify-content-center text-black"
                                style="background-color: #1997ce; color: white !important"
                                [routerLink]="['/master/gamification/competitions/add-competitions/player-selection']"
                                routerLinkActive="router-link-active">
                                <img src="Assets/AdminMasters/Add.svg" alt="Add Icon" height="16" width="16"
                                    class="me-2" />
                                Players
                            </button>
                        </div>

                        <!-- TEAM BUTTON -->
                        <div class="col-1" style="display: block;" *ngIf="competitionType === 'team'">
                            <button class="btn filter-btn d-flex align-items-center justify-content-center text-black"
                                style="background-color: #1997ce; color: white !important"
                                [routerLink]="['/master/gamification/competitions/add-competitions/team-head']"
                                routerLinkActive="router-link-active">
                                <img src="Assets/AdminMasters/Add.svg" alt="Add Icon" height="16" width="16"
                                    class="me-2" />
                                Team
                            </button>
                        </div>

                    </div>
                </div>
                <div class="col-12 mt-3" *ngIf="selected_players > 0">
                    <div *ngIf="selected_players_Head < 0">
                        <div class="accordion" id="accordionExample">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        Selected Players ({{ selected_players }})
                                    </button>
                                </h2>
                                <div id="collapseOne" class="accordion-collapse collapse show"
                                    aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                    <div class="accordion-body">
                                        <div class="col-12 d-flex align-items-center gap-3 mb-3">
                                            <div class="position-relative col-12">
                                                <fa-icon [icon]="faSearch" class="search-icon"
                                                    style="font-size: 18px;"></fa-icon>
                                                <input type="text" class="form-control ps-5" placeholder="Search" />
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <table class="table table-bordered align-middle table-fixed">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 10px;"></th>
                                                        <th>Players</th>
                                                        <th style="width: 200px;">Target</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let player of selectedPlayers; let i = index">
                                                        <!-- Delete Icon -->
                                                        <td class="text-center">
                                                            <img src="Assets/Gamification/Delete.svg" alt="Delete"
                                                                style="cursor: pointer; height: 20px; width: 20px;"
                                                                (click)="removePlayer(i)" />
                                                        </td>

                                                        <!-- Player Info -->
                                                        <td>
                                                            <div class="d-flex align-items-center gap-2">
                                                                <img [src]="player.profileImage" alt="profile_pic"
                                                                    class="rounded-circle" width="40" height="40" />
                                                                <div>
                                                                    <h6 class="mb-0">{{ player.name }}</h6>
                                                                    <small class="text-muted">{{ player.designation
                                                                        }}</small>
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <!-- Target Input -->
                                                        <td>
                                                            <div class="col-6">
                                                                <input class="form-control" type="text" readonly
                                                                    style="background-color: #D9D9D9 !important;" />
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3 border" *ngIf="selected_players_Head > 0">
                    <div class="row col-12 position-relative" *ngFor="let block of teamBlocks; let i = index">

                        <!-- Remove Button -->
                        <button type="button"
                            class="btn btn-sm position-absolute text-end end-0 p-0 bg-transparent border-0"
                            style="z-index: 10; top:10px" (click)="removeTeamHead(i)">
                            <img src="Assets/Add Product Details/Minus_Fill.svg" alt="Remove"
                                style="width: 30px; height: 30px;" />
                        </button>

                        <!-- Team Head -->
                        <div class="col-4 mt-3">
                            <div class="mb-3">
                                <label class="form-label">Team Head <span class="text-danger">*</span></label>
                                <ng-select [ngModelOptions]="{standalone: true}" [(ngModel)]="block.teamHead"
                                    [items]="teamHeadList" bindLabel="name" placeholder="Select Team Head"
                                    [searchable]="true">
                                </ng-select>
                            </div>
                        </div>

                        <!-- Team Name -->
                        <div class="col-4 mt-3">
                            <div class="mb-3">
                                <label class="form-label">Team Name <span class="text-danger">*</span></label>
                                <div class="calendar-reisze">
                                    <mat-form-field appearance="outline" class="w-100">
                                        <input matInput type="text" [(ngModel)]="block.teamName"
                                            [ngModelOptions]="{standalone: true}">
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>

                        <!-- Logo Upload -->
                        <div class="col-4 mt-3">
                            <label class="form-label">Team Logo</label>
                            <div class="position-relative">
                                <input type="text" class="form-control pe-5" [(ngModel)]="block.prdtImage"
                                    [ngModelOptions]="{standalone: true}" readonly />
                                <img src="Assets/Add Product Details/ProductImageUpload.svg" alt="Upload Icon"
                                    class="input-icon" (click)="triggerFileUpload(i)" />
                                <input type="file" #fileInput accept="image/*" (change)="onImageSelected($event, i)"
                                    hidden />
                            </div>
                        </div>

                        <!-- Image Preview -->
                        <div class="col-12" *ngIf="block.imagePreviews.length">
                            <label class="form-label">Preview Images</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div *ngFor="let img of block.imagePreviews; let j = index"
                                    class="position-relative me-2 mb-2">
                                    <img [src]="img" class="img-thumbnail"
                                        style="max-width: 150px; max-height: 150px;" />
                                    <button type="button"
                                        class="btn btn-sm position-absolute top-0 end-0 p-0 bg-transparent border-0"
                                        (click)="removeImage(i, j)">
                                        <img src="Assets/Add Product Details/Minus_Fill.svg" alt="Remove"
                                            style="width: 30px; height: 30px;" />
                                    </button>
                                </div>

                                <!-- Upload More -->
                                <button type="button"
                                    class="btn btn-outline-primary d-flex align-items-center justify-content-center"
                                    style="width: 30px; height: 30px;" (click)="triggerFileUpload(i)">
                                    +
                                </button>
                            </div>
                        </div>
                        <div class="accordion" id="accordionExample">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingOne">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseHead" aria-expanded="true"
                                        aria-controls="collapseHead">
                                        Selected Players ({{ selected_players }})
                                    </button>
                                </h2>
                                <div id="collapseHead" class="accordion-collapse collapse show"
                                    aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                    <div class="accordion-body">
                                        <div class="col-12 d-flex align-items-center gap-3 mb-3">
                                            <div class="position-relative col-12">
                                                <fa-icon [icon]="faSearch" class="search-icon"
                                                    style="font-size: 18px;"></fa-icon>
                                                <input type="text" class="form-control ps-5" placeholder="Search" />
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex gap-2 justify-content-start align-items-center">
                                            <button
                                                class="btn filter-btn d-flex align-items-center mb-2 justify-content-center text-black"
                                                style="background-color: #1997ce; color: white !important">
                                                <img src="Assets/AdminMasters/Add.svg" alt="Add Icon" height="16"
                                                    width="16" />
                                            </button>
                                            <p style="margin-bottom: 10px !important;">Players</p>
                                        </div>
                                        <div class="col-12">
                                            <table class="table table-bordered align-middle table-fixed">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th style="width: 10px;"></th>
                                                        <th>Players</th>
                                                        <th style="width: 200px;">Target</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let player of selectedPlayers; let i = index">
                                                        <!-- Delete Icon -->
                                                        <td class="text-center">
                                                            <img src="Assets/Gamification/Delete.svg" alt="Delete"
                                                                style="cursor: pointer; height: 20px; width: 20px;"
                                                                (click)="removePlayer(i)" />
                                                        </td>

                                                        <!-- Player Info -->
                                                        <td>
                                                            <div class="d-flex align-items-center gap-2">
                                                                <img [src]="player.profileImage" alt="profile_pic"
                                                                    class="rounded-circle" width="40" height="40" />
                                                                <div>
                                                                    <h6 class="mb-0">{{ player.name }}</h6>
                                                                    <small class="text-muted">{{ player.designation
                                                                        }}</small>
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <!-- Target Input -->
                                                        <td>
                                                            <div class="col-6">
                                                                <input class="form-control" type="text" readonly
                                                                    style="background-color: #D9D9D9 !important;" />
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex-grow-1">
                    <hr [ngStyle]="{'margin-top': selected_players >  0 ? '20px' : '260px'}" />
                </div>
                <div class="row">
                    <div class="col-6 d-flex gap-2 justify-content-start align-items-center"><button
                            class="btn custom-style" (click)="closeCard()">Close</button></div>
                    <div class="col-6 d-flex gap-2 justify-content-end align-items-center">
                        <button class="btn btn-outline-secondary" matStepperPrevious>Previous</button>
                        <button class="btn btn-primary" matStepperNext (click)="onSecondStepNext()">Next</button>
                    </div>
                </div>
            </div>
        </mat-step>
        <!-- ! PRIZES -->
        <mat-step [stepControl]="thirdFormGroup" [editable]="isEditable">
            <form [formGroup]="thirdFormGroup">
                <ng-template matStepLabel>Prizes</ng-template>
                <mat-form-field>
                    <mat-label>Prizes</mat-label>
                    <input matInput formControlName="thirdCtrl" placeholder="Ex. 1 Main St, New York, NY" required>
                </mat-form-field>
                <div>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </form>
        </mat-step>
        <!-- ! SETTINGS -->
        <mat-step [stepControl]="fourthFormGroup" [editable]="isEditable">
            <form [formGroup]="fourthFormGroup">
                <ng-template matStepLabel>Settings</ng-template>
                <mat-form-field>
                    <mat-label>Settings</mat-label>
                    <input matInput formControlName="fourthCtrl" placeholder="Ex. 1 Main St, New York, NY" required>
                </mat-form-field>
                <div>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </form>
        </mat-step>
        <!-- ! THEMES -->
        <mat-step [stepControl]="fifthFormGroup" [editable]="isEditable">
            <form [formGroup]="fifthFormGroup">
                <ng-template matStepLabel>Themes</ng-template>
                <mat-form-field>
                    <mat-label>Thems</mat-label>
                    <input matInput formControlName="fifthCtrl" placeholder="Ex. 1 Main St, New York, NY" required>
                </mat-form-field>
                <div>
                    <button mat-button matStepperNext>Next</button>
                    <button mat-button (click)="stepper.reset()">Reset</button>
                </div>
            </form>
        </mat-step>
    </mat-stepper>
</div>
<router-outlet></router-outlet>